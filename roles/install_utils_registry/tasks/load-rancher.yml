---
# Load Cert
- name: Find Cert-manager images on the target server
  ansible.builtin.find:
    paths: "{{ mount_images_path }}/cert/"
    patterns: "*.tar"
  register: found_images

- name: Copy Cert-manager images with skopeo
  ansible.builtin.command: "skopeo copy docker-archive:{{ item.path }} docker://localhost:5000/cert/{{ item.path | basename | regex_replace('.tar', '') | regex_replace('_', ':') }} --dest-tls-verify=false"
  changed_when: false
  with_items: "{{ found_images['files'] }}"

# Load Rancher
- name: Find Rancher images on the target server
  ansible.builtin.find:
    paths: "{{ mount_images_path }}/rancher/"
    patterns: "*.tar"
  register: found_images

- name: Copy Rancher images with skopeo
  ansible.builtin.command: "skopeo copy docker-archive:{{ item.path }} docker://localhost:5000/rancher/{{ item.path | basename | regex_replace('.tar', '') | regex_replace('_', ':') }} --dest-tls-verify=false"
  changed_when: false
  with_items: "{{ found_images['files'] }}"
