---
# Load Longhorn
- name: Find longhorn images on the target server
  ansible.builtin.find:
    paths: "{{ mount_images_path }}/longhorn/"
    patterns: "*.tar"
  register: found_images

- name: Copy longhorn images with skopeo
  ansible.builtin.command: "skopeo copy docker-archive:{{ item.path }} docker://localhost:5000/longhornio/{{ item.path | basename | regex_replace('.tar', '') | regex_replace('_', ':') }} --dest-tls-verify=false"
  changed_when: false
  with_items: "{{ found_images['files'] }}"
